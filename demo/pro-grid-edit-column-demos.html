<dom-module id="pro-grid-edit-column-demos">
  <template>
    <style include="vaadin-component-demo-shared-styles">
      :host {
        display: block;
      }
    </style>

    <h3>Edit Column</h3>
    <p>
      <code>&lt;vaadin-pro-grid&gt;</code> has the helper for inline cell editing in specific columns</code>.
    </p>
    <p>
      Edit mode can be activated in one of the following ways:
    </p>
    <ul>
      <li>Double click on the editable cell</li>
      <li>Pressing <kbd>Enter</kbd>, when editable cell is focused using keyboard</li>
      <li>Pressing <kbd>Space</kbd>, when editable cell is focused using keyboard</li>
      <!-- TODO: <li>Typing alphanumeric character, when editable cell is focused using keyboard</li>-->
    </ul>
    <p>
      When edit mode is activated for the cell, the following keys <b>change behavior</b>:
    </p>
    <ul>
      <li><kbd>Esc</kbd> - save changes and exit the edit mode</li>
      <li><kbd>Enter</kbd> and <kbd>Shift</kbd> + <kbd>Enter</kbd> - save changes and exit the edit mode</li>
      <li><kbd>Tab</kbd> - exit the edit mode and focus the next editable cell</li>
      <li><kbd>Shift</kbd> + <kbd>Tab</kbd> - exit the edit mode and focus the previous editable cell</li>
    </ul>
    <p>
      <b>NOTE: You must explicitly import <code>&lt;vaadin-grid-edit-column&gt;</code>) in order to use it</b>
    </p>
    <vaadin-demo-snippet id="pro-grid-edit-column-demos-edit-column">
      <template preserve-content>
        <vaadin-pro-grid>
          <vaadin-pro-grid-edit-column path="name.first" header="First name (edit)"></vaadin-pro-grid-edit-column>
          <vaadin-grid-column path="name.last" header="Last name (view)"></vaadin-grid-column>
          <vaadin-pro-grid-edit-column path="name.last" header="Last name (edit)"></vaadin-pro-grid-edit-column>
        </vaadin-pro-grid>
        <script>
          window.addDemoReadyListener('#pro-grid-edit-column-demos-edit-column', function(document) {
            // Assign an array of user objects as the pro grid's items
            document.querySelector('vaadin-pro-grid').items = Vaadin.GridDemo.users;
          });
        </script>
      </template>
    </vaadin-demo-snippet>

    <h3>Allow Enter Row Change</h3>
    <p>
      When <code>allowEnterRowChange</code> is set on the grid element, the following keys <b>change behavior</b>:
    </p>
    <ul>
      <li><kbd>Enter</kbd> - save changes, exit the edit mode <b>and</b> focus the editable cell in the next row</li>
      <li><kbd>Shift</kbd> + <kbd>Enter</kbd> - save changes, exit the edit mode <b>and</b> focus the editable cell in the previous row</li>
    </ul>
    <vaadin-demo-snippet id="pro-grid-edit-column-demos-allow-enter-row-change">
      <template preserve-content>
        <vaadin-pro-grid allow-enter-row-change>
          <vaadin-pro-grid-edit-column path="name.first" header="First name (edit)"></vaadin-pro-grid-edit-column>
          <vaadin-grid-column path="name.last" header="Last name (view)"></vaadin-grid-column>
          <vaadin-pro-grid-edit-column path="name.last" header="Last name (edit)"></vaadin-pro-grid-edit-column>
        </vaadin-pro-grid>
        <script>
          window.addDemoReadyListener('#pro-grid-edit-column-demos-allow-enter-row-change', function(document) {
            // Assign an array of user objects as the pro grid's items
            document.querySelector('vaadin-pro-grid').items = Vaadin.GridDemo.users;
          });
        </script>
      </template>
    </vaadin-demo-snippet>

    <h3>Preserve Edit Mode</h3>
    <p>
      When <code>preserveEditMode</code> is set on the grid element, focusing the next editable cell from keyboard will activate edit mode for it.
    </p>
    <vaadin-demo-snippet id="pro-grid-edit-column-demos-preserve-edit-mode">
      <template preserve-content>
        <vaadin-pro-grid preserve-edit-mode allow-enter-row-change>
          <vaadin-pro-grid-edit-column path="name.first" header="First name (edit)"></vaadin-pro-grid-edit-column>
          <vaadin-grid-column path="name.last" header="Last name (view)"></vaadin-grid-column>
          <vaadin-pro-grid-edit-column path="name.last" header="Last name (edit)"></vaadin-pro-grid-edit-column>
        </vaadin-pro-grid>
        <script>
          window.addDemoReadyListener('#pro-grid-edit-column-demos-preserve-edit-mode', function(document) {
            // Assign an array of user objects as the pro grid's items
            document.querySelector('vaadin-pro-grid').items = Vaadin.GridDemo.users;
          });
        </script>
      </template>
    </vaadin-demo-snippet>

    <h3>Prevent Saving Change</h3>
    <p>
      Before exiting the cell edit mode, <code>item-property-changed</code> event is fired. You can listen to it
      and call <code>event.preventDefault()</code> to prevent saving change. The example below demonstrates
      how to silently rollback change in case of the unexpected value.
    </p>
    <vaadin-demo-snippet id="pro-grid-edit-column-demos-item-property-changed">
      <template preserve-content>
        <vaadin-pro-grid>
          <vaadin-grid-column path="name.first" header="First Name" width="60px"></vaadin-grid-column>
          <vaadin-grid-column path="name.last" header="Last name" width="60px"></vaadin-grid-column>
          <vaadin-pro-grid-edit-column path="phone" header="Phone (edit)" width="80px"></vaadin-pro-grid-edit-column>
          <vaadin-pro-grid-edit-column path="email" header="Email (edit)"></vaadin-pro-grid-edit-column>
        </vaadin-pro-grid>
        <script>
          window.addDemoReadyListener('#pro-grid-edit-column-demos-item-property-changed', function(document) {
            const grid = document.querySelector('vaadin-pro-grid');

            grid.addEventListener('item-property-changed', function(event) {
              switch (event.detail.path) {
                case 'phone':
                  if (!/^[0-9\-]+$/.test(event.detail.value)) {
                    // phone is not correct
                    event.preventDefault();
                  }
                  break;
                case 'email':
                  if (!/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/.test(event.detail.value)) {
                    // email is not correct
                    event.preventDefault();
                  }
                  break;
              }
            });

            // Assign an array of user objects as the pro grid's items
            grid.items = Vaadin.GridDemo.users;
          });
        </script>
      </template>
    </vaadin-demo-snippet>

    <h3>Editor Type</h3>
    <p>
      The <code>editorType</code> property allows to configure column editor type.
    </p>
    <vaadin-demo-snippet id="pro-grid-edit-column-demos-editor-type-boolean">
      <template preserve-content>
        <vaadin-pro-grid>
          <vaadin-grid-column path="name.first" header="First Name"></vaadin-grid-column>
          <vaadin-grid-column path="name.last" header="Last name"></vaadin-grid-column>
          <vaadin-pro-grid-edit-column path="married" header="Married (edit)" editor-type="boolean"></vaadin-pro-grid-edit-column>
        </vaadin-pro-grid>
        <script>
          window.addDemoReadyListener('#pro-grid-edit-column-demos-editor-type-boolean', function(document) {
            const grid = document.querySelector('vaadin-pro-grid');

            // Assign an array of user objects as the pro grid's items
            grid.items = Vaadin.GridDemo.users.map(item => {
              const user = Object.assign({}, item);
              user.married = item.name.title === 'mrs';
              return user;
            });
          });
        </script>
      </template>
    </vaadin-demo-snippet>

    <h3>Custom Edit Mode Renderer</h3>
    <p>
      The custom editor component can be rendered for cell edit mode using <b><code>editModeRenderer</code></b>.
      The component must be first child of the edited cell content, and should be focusable (grid will exit
      cell edit mode on blur). If component is an <code>&lt;input&gt;</code>, it will be selected.
    </p>
    <p>
      By default, cell value corresponding to the column <code>path</code> is mapped to the <code>value</code>
      property of the editor component. You can use <b><code>editorValuePath</code></b> property of the column
      element to map cell value to another property (or a sub-property).
    </p>
    <p>
      The demo below is an example of using <code>&lt;input&gt;</code> element and
      <code>&lt;vaadin-combo-box&gt;</code> component as cell editors. Grid edit mode styling does not apply
      to the custom editor components, but you can use CSS, same as for cell content in non-edit mode.
    </p>
    <vaadin-demo-snippet id="pro-grid-edit-column-demos-edit-mode-renderer">
      <template preserve-content>
        <vaadin-pro-grid>
          <vaadin-grid-column path="name.first" header="First Name"></vaadin-grid-column>
          <vaadin-grid-column path="name.last" header="Last name"></vaadin-grid-column>
          <vaadin-pro-grid-edit-column path="name.title" header="Title (edit)" editor-value-path="selectedItem"></vaadin-pro-grid-edit-column>
          <vaadin-pro-grid-edit-column path="location.zip" header="Zip code (edit)" text-align="end"></vaadin-pro-grid-edit-column>
        </vaadin-pro-grid>
        <script>
          window.addDemoReadyListener('#pro-grid-edit-column-demos-edit-mode-renderer', function(document) {
            const grid = document.querySelector('vaadin-pro-grid');
            grid.querySelector('[path="name.title"]').editModeRenderer = function(root, column, rowData) {
              root.innerHTML = '';
              const combobox = window.document.createElement('vaadin-combo-box');
              combobox.items = ['mr', 'mrs', 'ms'];
              root.appendChild(combobox);
            };

            grid.querySelector('[path$="zip"]').editModeRenderer = function(root, column, rowData) {
              root.innerHTML = '';
              const input = window.document.createElement('input');
              input.setAttribute('type', 'number');
              root.appendChild(input);
            };

            // Assign an array of user objects as the pro grid's items
            grid.items = Vaadin.GridDemo.users;
          });
        </script>
        <style>
          input[type="email"] {
            width: 100%;
          }
        </style>
      </template>
    </vaadin-demo-snippet>

    <h3>Custom Edit Mode Template</h3>
    <p>
      The custom editor component can be also rendered for cell edit mode using <code>&lt;template&gt;</code>
      element with the <code>editor</code> class name. The requirements for the custom editor component are
      the same as when using <code>editModeRenderer</code>.
    </p>
    <vaadin-demo-snippet id="pro-grid-edit-column-demos-edit-mode-template">
      <template preserve-content>
        <vaadin-pro-grid>
          <vaadin-grid-column path="name.first" header="First Name"></vaadin-grid-column>
          <vaadin-grid-column path="name.last" header="Last name"></vaadin-grid-column>
          <vaadin-pro-grid-edit-column path="email" header="Email (edit)" width="150px">
            <template>[[item.email]]</template>
            <template class="editor">
              <input type="email" value="{{item.email::input}}">
            </template>
          </vaadin-pro-grid-edit-column>
          <vaadin-pro-grid-edit-column path="location.zip" header="Zip code (edit)" text-align="end">
            <template class="editor">
              <input type="number" value="{{item.location.zip::input}}">
            </template>
          </vaadin-pro-grid-edit-column>
        </vaadin-pro-grid>
        <style>
          input[type="email"] {
            width: 100%;
          }
        </style>
        <script>
          window.addDemoReadyListener('#pro-grid-edit-column-demos-edit-mode-template', function(document) {
            document.querySelector('vaadin-pro-grid').items = Vaadin.GridDemo.users;
          });
        </script>
      </template>
    </vaadin-demo-snippet>

  </template>
  <script>
    class ProGridEditColumnDemos extends DemoReadyEventEmitter(ProGridDemo(Polymer.Element)) {
      static get is() {
        return 'pro-grid-edit-column-demos';
      }
    }
    customElements.define(ProGridEditColumnDemos.is, ProGridEditColumnDemos);
  </script>
</dom-module>
